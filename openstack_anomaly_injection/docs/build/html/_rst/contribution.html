

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Contribution &mdash; Chaos toolkit 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Node Control Drivers" href="node_control/drivers.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Chaos toolkit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html"> Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="anomaly_injection/anomaly_injection.html"> Anomaly Injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="anomaly_injection/anomalies/anomalies.html"> Anomalies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="anomaly_injection/anomalies/network/network.html">Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="anomaly_injection/anomalies/stress/stress.html">Stress</a></li>
<li class="toctree-l2"><a class="reference internal" href="anomaly_injection/anomalies/system/system.html">System</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="node_control/node_control.html"> Node Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="node_control/api.html">Api</a></li>
<li class="toctree-l2"><a class="reference internal" href="node_control/drivers.html">Drivers</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Contributing</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#implementing-new-anomalies">Implementing new anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extend-node-control">Extend Node Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implement-api-methods">Implement API methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implement-driver-methods">Implement Driver methods</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Chaos toolkit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Contribution</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/_rst/contribution.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
      
        <a href="node_control/drivers.html" class="btn btn-neutral float-left" title="Node Control Drivers" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="contribution">
<h1>Contribution<a class="headerlink" href="#contribution" title="Permalink to this headline">¶</a></h1>
<div class="section" id="implementing-new-anomalies">
<h2>Implementing new anomalies<a class="headerlink" href="#implementing-new-anomalies" title="Permalink to this headline">¶</a></h2>
<div class="section" id="choose-anomaly-group">
<h3>1. Choose anomaly group<a class="headerlink" href="#choose-anomaly-group" title="Permalink to this headline">¶</a></h3>
<p>The new anomaly can belong in one of the three groups: <code class="docutils literal notranslate"><span class="pre">network</span></code>, <code class="docutils literal notranslate"><span class="pre">stress</span></code> and <code class="docutils literal notranslate"><span class="pre">system</span></code>.</p>
</div>
<div class="section" id="create-new-anomaly-class">
<h3>2. Create new anomaly class<a class="headerlink" href="#create-new-anomaly-class" title="Permalink to this headline">¶</a></h3>
<p>When implementing a new anomaly, make sure you create a separate file for the class.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t forget to inherit from the base <code class="docutils literal notranslate"><span class="pre">Anomaly</span></code> class.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PauseAnomaly</span><span class="p">(</span><span class="n">Anomaly</span><span class="p">):</span>
     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
         <span class="n">supported_targets</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;deployment&quot;</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">]</span>
         <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Pause&quot;</span>
         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">supported_targets</span><span class="o">=</span><span class="n">supported_targets</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">class_specific_params</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>You must specify which targets does the anomaly support in <code class="docutils literal notranslate"><span class="pre">supported_targets</span></code>. Possible targets are <code class="docutils literal notranslate"><span class="pre">deployment</span></code>,
<code class="docutils literal notranslate"><span class="pre">host</span></code>, <code class="docutils literal notranslate"><span class="pre">container</span></code>, <code class="docutils literal notranslate"><span class="pre">network</span></code>.</p></li>
<li><p>You must specify the <code class="docutils literal notranslate"><span class="pre">name</span></code> of the anomaly.</p></li>
</ul>
</div>
<p>If you want to implement logging, use any of the following loggers:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log_info</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;infoLog&#39;</span><span class="p">)</span>
<span class="n">log_error</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;errorLog&#39;</span><span class="p">)</span>
<span class="n">log_debug</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;debuggerLog&#39;</span><span class="p">)</span>
<span class="n">log_status</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;statusLog&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="implement-methods">
<h3>3. Implement methods<a class="headerlink" href="#implement-methods" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>You must implement the following methods:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_run()</span></code> - This function should contain the logic for implementing the anomaly</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_unpack_params(params)</span></code> - This function should unpack the anomaly-specific parameters from the params dictionary.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>You don’t need to implement the arguments for <code class="docutils literal notranslate"><span class="pre">delay</span></code> and <code class="docutils literal notranslate"><span class="pre">duration</span></code>.</p></li>
<li><p>You don’t have to implement the delay functionality as it is already implemented in the base <code class="docutils literal notranslate"><span class="pre">Anomaly</span></code> class.</p></li>
</ul>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_unpack_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">convert_time_to_s</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="s1">&#39;0s&#39;</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">convert_time_to_s</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delay&#39;</span><span class="p">,</span> <span class="s1">&#39;0s&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">start</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>Every anomaly class receives <code class="docutils literal notranslate"><span class="pre">target</span></code> object from <code class="docutils literal notranslate"><span class="pre">node_control/api</span></code> folder.
If a target method needs to be implemented, please refer to the <a class="reference internal" href="#implement-api-methods">Implement API methods</a></p>
</div>
<div class="section" id="import-class-to-init-py">
<h3>4. Import class to <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code><a class="headerlink" href="#import-class-to-init-py" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>In the <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> of the new anomaly directory, add the following:</dt><dd><ul class="simple">
<li><p>import the class</p></li>
<li><p>add the class to the <code class="docutils literal notranslate"><span class="pre">__all__</span></code> list.</p></li>
</ul>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">.pause</span> <span class="kn">import</span> <span class="n">PauseAnomaly</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PauseAnomaly&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="add-anomaly-in-the-anomaly-injector">
<h3>5. Add anomaly in the anomaly injector<a class="headerlink" href="#add-anomaly-in-the-anomaly-injector" title="Permalink to this headline">¶</a></h3>
<p>In the <code class="docutils literal notranslate"><span class="pre">anomaly_injection/injector.py</span></code> file add the anomaly to the <code class="docutils literal notranslate"><span class="pre">_anomaly_cls</span></code> dictionary</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AnomalyInjector</span><span class="p">:</span>
    <span class="n">_anomaly_cls</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pause&quot;</span><span class="p">:</span> <span class="n">PauseAnomaly</span><span class="p">,</span> <span class="s2">&quot;stress-ng&quot;</span><span class="p">:</span> <span class="n">StressNgAnomaly</span><span class="p">,</span><span class="s2">&quot;new-anomaly&quot;</span><span class="p">:</span><span class="n">NewAnomalyClass</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You don’t have to import the class in the file if you already imported it in step 3.</p>
</div>
</div>
<div class="section" id="create-argument-parser-for-the-anomaly">
<h3>6. Create argument parser for the anomaly<a class="headerlink" href="#create-argument-parser-for-the-anomaly" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>In the <code class="docutils literal notranslate"><span class="pre">anomaly_injection/config/argparser/&lt;anomaly_group&gt;.py</span></code> file:</dt><dd><ul class="simple">
<li><p>Add new parser</p></li>
<li><p>Add arguments to the parser</p></li>
</ul>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># add new parser</span>
<span class="n">stress_ng_anom</span> <span class="o">=</span> <span class="n">sub_stress</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s2">&quot;stress-ng&quot;</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">default_args</span><span class="p">])</span>
<span class="c1"># add arguments</span>
<span class="n">stress_ng_anom</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--stressors&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;param_stressors&quot;</span><span class="p">,</span>
                            <span class="n">help</span><span class="o">=</span><span class="s2">&quot;String containing stress-ng params. &quot;</span>
                                 <span class="s2">&quot;Eg. </span><span class="se">\&quot;</span><span class="s2">--cpu 2</span><span class="se">\&quot;</span><span class="s2">. Avoid using &#39;-t&#39; in the stressors string. Instead use the duration&quot;</span>
                                  <span class="s2">&quot; parameter of the anomaly to specify duration &quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>You must use <code class="docutils literal notranslate"><span class="pre">add_parser()</span></code> in order to create new sub parser.</p></li>
<li><p>You don’t need to implement the arguments for <code class="docutils literal notranslate"><span class="pre">delay</span></code> and <code class="docutils literal notranslate"><span class="pre">duration</span></code>.</p></li>
<li><p>the <code class="docutils literal notranslate"><span class="pre">add_parser()</span></code> method must have the <code class="docutils literal notranslate"><span class="pre">parents=[default_args]</span></code> parameter in order to inherit the arguments for
<code class="docutils literal notranslate"><span class="pre">delay</span></code> and <code class="docutils literal notranslate"><span class="pre">duration</span></code>.</p></li>
</ul>
</div>
</div>
</div>
<div class="section" id="extend-node-control">
<h2>Extend Node Control<a class="headerlink" href="#extend-node-control" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="implement-api-methods">
<h2>Implement API methods<a class="headerlink" href="#implement-api-methods" title="Permalink to this headline">¶</a></h2>
<p>Implementing API methods is pretty straightforward. When implementing new methods, you only need to pass arguments to the
corresponding driver method. If the driver method is not implemented, please refer to <a class="reference internal" href="#implement-driver-methods">Implement Driver methods</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code snippet from node_control/api/host.py</span>
<span class="k">def</span> <span class="nf">stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stressors</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">stress</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="n">stressors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="implement-driver-methods">
<h2>Implement Driver methods<a class="headerlink" href="#implement-driver-methods" title="Permalink to this headline">¶</a></h2>
<p>In order to implement the driver method, you need to prepare <code class="docutils literal notranslate"><span class="pre">ansible-playbook</span></code> task as dictionary, define hosts,
and pass the arguments to the <code class="docutils literal notranslate"><span class="pre">_run_task()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">stressors</span><span class="p">):</span>
    <span class="n">task</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;cmd&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;stress-ng &#39;</span> <span class="o">+</span> <span class="n">stressors</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span><span class="n">host</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_task</span><span class="p">(</span><span class="n">hosts</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="s1">&#39;Stress&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="node_control/drivers.html" class="btn btn-neutral float-left" title="Node Control Drivers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, cit.tu-berlin.de.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

<style>
    @import url('https://fonts.googleapis.com/css?family=Inconsolata');
</style>


</body>
</html>